# å°†é™æ€å†…å®¹éƒ¨ç½²åˆ° GitHub Pages çš„ç®€æ˜“å·¥ä½œæµç¨‹
name: Deploy static content to Pages

on:
  # ä»…åœ¨æ¨é€åˆ°é»˜è®¤åˆ†æ”¯æ—¶è¿è¡Œã€‚
  push:
    branches: ['master']

  # è¿™ä¸ªé€‰é¡¹å¯ä»¥ä½¿ä½ æ‰‹åŠ¨åœ¨ Action tab é¡µé¢è§¦å‘å·¥ä½œæµ
  workflow_dispatch:

# è®¾ç½® GITHUB_TOKEN çš„æƒé™ï¼Œä»¥å…è®¸éƒ¨ç½²åˆ° GitHub Pagesã€‚
permissions:
  contents: read
  pages: write
  id-token: write

# å…è®¸ä¸€ä¸ªå¹¶å‘çš„éƒ¨ç½²
concurrency:
  group: 'pages'
  cancel-in-progress: true

jobs:
  # å•æ¬¡éƒ¨ç½²çš„å·¥ä½œæè¿°
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'
      - name: Install dependencies
        run: npm ci
      - name: Build
        run: npm run build
      - name: Setup Pages
        uses: actions/configure-pages@v4
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # Upload dist folder
          path: './dist'
          
      - name: Generate 404 Page ğŸ”§ # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
        run: |
          echo "<!DOCTYPE html>" > dist/404.html
          echo "<html>" >> dist/404.html
          echo "  <head>" >> dist/404.html
          echo "    <title>Redirecting...</title>" >> dist/404.html
          echo "    <script>" >> dist/404.html
          echo "      const path = location.pathname;" >> dist/404.html
          echo "      const pos = path.indexOf('\/', 1);" >> dist/404.html
          echo "      const repo = path.substring(0, pos);" >> dist/404.html
          echo "      const ghpage = path.substring(pos);" >> dist/404.html
          echo "      const redirectUrl = location.origin+repo+'/?ghpage='+encodeURIComponent(ghpage+location.search);" >> dist/404.html
          echo "      window.location.replace(redirectUrl);" >> dist/404.html
          echo "    </script>" >> dist/404.html
          echo "  </head>" >> dist/404.html
          echo "  <body>" >> dist/404.html
          echo "    Redirecting..." >> dist/404.html
          echo "  </body>" >> dist/404.html
          echo "</html>" >> dist/404.html

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
